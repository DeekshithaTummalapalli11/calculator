<!DOCTYPE html>
<html>
<head>
    <title>Calculator</title>
    <style>
        body { font-family: Arial; background: #f4f4f4; }
        .calc { width: 320px; margin: 40px auto; background: white; padding: 20px; }
        input { width: 100%; font-size: 22px; padding: 10px; text-align: right; }

        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        button { padding: 14px; font-size: 18px; cursor: pointer; }
        .clear { grid-column: span 4; background: #ff6b6b; color: white; }

        .history-box {
            display: none;
            margin-top: 12px;
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 8px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 14px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-icon {
            cursor: pointer;
            font-size: 22px;
        }
    </style>
</head>
<body>

<div class="calc">

    <!-- HEADER -->
    <div class="header">
        <h2>ðŸ§® Calculator</h2>
<span class="history-icon" onclick="toggleHistory()" title="History">ðŸ“œ</span>

    </div>

    <form method="POST">
        <input type="text" id="expression" name="expression"
               value="{{ expression }}" autocomplete="off">

        <div class="buttons">
            <button type="button" onclick="press('7')">7</button>
            <button type="button" onclick="press('8')">8</button>
            <button type="button" onclick="press('9')">9</button>
            <button type="button" onclick="press('/')">/</button>

            <button type="button" onclick="press('4')">4</button>
            <button type="button" onclick="press('5')">5</button>
            <button type="button" onclick="press('6')">6</button>
            <button type="button" onclick="press('*')">*</button>

            <button type="button" onclick="press('1')">1</button>
            <button type="button" onclick="press('2')">2</button>
            <button type="button" onclick="press('3')">3</button>
            <button type="button" onclick="press('-')">-</button>

            <button type="button" onclick="press('0')">0</button>
            <button type="button" onclick="press('.')">.</button>
            <button type="submit">=</button>
            <button type="button" onclick="press('+')">+</button>

            <button type="button" onclick="backspace()">X</button>
            <button type="button" class="clear" onclick="clearInput()">C</button>
        </div>
    </form>

    <p><b>Result:</b> {{ result }}</p>

    <!-- HISTORY PANEL -->
    <div id="historyBox" class="history-box">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <b>History</b>
            <a href="/clear-history" style="font-size:13px;">Clear</a>
        </div>
        <hr>
        {% for h in history %}
            <div>{{ h }}</div>
        {% endfor %}
    </div>
</div>

<script>
const input = document.getElementById("expression");
const operators = "+-*/";

/* REAL-TIME operator replacement */
input.addEventListener("beforeinput", function (e) {
    if (!e.data) return;

    const ch = e.data;
    const v = input.value;

    if (operators.includes(ch) &&
        v.length && operators.includes(v[v.length - 1])) {
        e.preventDefault();
        input.value = v.slice(0, -1) + ch;
    }
});

/* Button logic */
function press(ch) {
    const v = input.value;
    if (operators.includes(ch) &&
        v.length && operators.includes(v[v.length - 1])) {
        input.value = v.slice(0, -1) + ch;
    } else {
        input.value += ch;
    }
}

function backspace() {
    input.value = input.value.slice(0, -1);
}

function clearInput() {
    input.value = "";
}

/* HISTORY TOGGLE */
function toggleHistory() {
    const box = document.getElementById("historyBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
}
</script>

</body>
</html>
